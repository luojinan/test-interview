<!-- Generated by SpecStory -->

# 移除currentCategoryId逻辑并使用scriptUrl (2025-06-07 18:59:06)

_**User**_

移除所有currentCategoryId相关的逻辑，改为使用数据源中的scriptUrl作为标识@useInterviewBank.ts 

---

_**Assistant**_



---

[MODE: RESEARCH]

分析当前的`useInterviewBank.ts`文件，发现`currentCategoryId`在以下地方被使用：

1. **状态定义**：`currentCategoryId: Ref<string>`
2. **计算属性**：`currentCategory`和`currentQuestions`中用于过滤
3. **偏好设置**：`selectedCategoryId`字段  
4. **函数**：`switchCategory`、`updatePreferences`
5. **监听器**：`watch(currentCategoryId)`

需要将这些都改为使用`scriptUrl`作为标识，同时需要检查数据源配置以了解`scriptUrl`的结构。

从数据源配置可以看到，每个数据源都有一个唯一的`scriptUrl`，如`'/data/interviews/zhongruan-software-testing-interview.min.js'`，这可以作为数据源的唯一标识。

[MODE: PLAN]

**修改计划：**

1. **状态字段重命名**：
   - `currentCategoryId` → `currentScriptUrl`
   - 相关类型定义中的`selectedCategoryId` → `selectedScriptUrl`

2. **计算属性更新**：
   - `currentCategory` → `currentDataSource`（基于scriptUrl查找）
   - `currentQuestions`中的过滤逻辑改为使用scriptUrl

3. **函数重构**：
   - `switchCategory` → `switchDataSource`
   - 更新相关的偏好设置保存逻辑

4. **偏好设置字段**：
   - `UserPreferences`接口中的`selectedCategoryId` → `selectedScriptUrl`
   - 相关的加载和保存逻辑

5. **监听器更新**：
   - 监听`currentScriptUrl`而不是`currentCategoryId`

6. **初始化逻辑**：
   - 默认选择第一个数据源的scriptUrl
   - 验证逻辑改为检查scriptUrl是否存在

**实现清单：**
1. 修改状态定义，将currentCategoryId改为currentScriptUrl
2. 更新计算属性currentCategory和currentQuestions的实现
3. 重构switchCategory函数为switchDataSource
4. 修改偏好设置相关的字段名和逻辑
5. 更新watch监听器
6. 修改初始化逻辑中的默认选择机制
7. 更新所有相关的函数调用和引用

[MODE: EXECUTE]

---

```diff
    UserPreferences,
  } from "@/types/interview";
- import type { LoadingState } from "@/types/storage";
+ import type { LoadingState, ScriptConfig } from "@/types/storage";
  
  // ==================== Hook类型定义 ====================
```

```diff
    categories: Ref<Category[]>;
    questions: Ref<Question[]>;
-   currentCategoryId: Ref<string>;
+   currentScriptUrl: Ref<string>;
    searchQuery: Ref<string>;
    isLoading: Ref<boolean>;
```

```diff
  
    // 计算属性
-   currentCategory: ComputedRef<Category | undefined>;
+   currentDataSource: ComputedRef<ScriptConfig | undefined>;
    currentQuestions: ComputedRef<Question[]>;
    bookmarkedQuestions: ComputedRef<Question[]>;
```

```diff
    refreshData: (forceReload?: boolean) => Promise<boolean>;
  
-   // 分类操作
-   switchCategory: (categoryId: string) => void;
+   // 数据源操作
+   switchDataSource: (scriptUrl: string) => void;
  
    // 题目操作
```

```diff
    const categories = ref<Category[]>([]);
    const questions = ref<Question[]>([]);
-   const currentCategoryId = ref<string>("");
+   const currentScriptUrl = ref<string>("");
    const searchQuery = ref<string>("");
    const isLoading = ref<boolean>(false);
```

```diff
  
    const preferences = ref<UserPreferences>({
-     selectedCategoryId: "",
+     selectedScriptUrl: "",
      theme: "auto",
      autoExpandAnswers: false,
```

```diff
    // ==================== 计算属性 ====================
  
-   const currentCategory = computed(() =>
-     categories.value.find((cat) => cat.id === currentCategoryId.value),
-   );
+   const currentDataSource = computed(() => {
+     const dataSources = dataSourceManager.getDataSources();
+     return Object.values(dataSources).find(
+       (source) => source.scriptUrl === currentScriptUrl.value
+     );
+   });
  
    const currentQuestions = computed(() => {
-     let filtered = questions.value.filter(
-       (q) =>
-         currentCategoryId.value === "" ||
-         q.categoryId === currentCategoryId.value,
-     );
+     let filtered = questions.value;
+ 
+     // 根据当前选择的数据源过滤题目
+     if (currentScriptUrl.value) {
+       const dataSource = currentDataSource.value;
+       if (dataSource) {
+         // 通过categoryId过滤，因为题目数据中存储的是categoryId
+         filtered = questions.value.filter(
+           (q) => q.categoryId === dataSource.categoryId
+         );
+       }
+     }
  
      // 搜索过滤
```

```diff
        questions.value = result.questions;
  
-       // 设置默认分类
-       if (categories.value.length > 0 && !currentCategoryId.value) {
-         const savedCategoryId = preferences.value.selectedCategoryId;
-         const validCategory = categories.value.find(
-           (cat) => cat.id === savedCategoryId,
+       // 设置默认数据源
+       if (scriptConfigs.length > 0 && !currentScriptUrl.value) {
+         const savedScriptUrl = preferences.value.selectedScriptUrl;
+         const validDataSource = scriptConfigs.find(
+           (config) => config.scriptUrl === savedScriptUrl,
          );
  
-         currentCategoryId.value = validCategory
-           ? savedCategoryId
-           : categories.value[0].id;
-         preferences.value.selectedCategoryId = currentCategoryId.value;
+         currentScriptUrl.value = validDataSource
+           ? savedScriptUrl
+           : scriptConfigs[0].scriptUrl;
+         preferences.value.selectedScriptUrl = currentScriptUrl.value;
          await saveUserPreferences();
        }
```

```diff
      try {
        const keys = [
-         "selectedCategoryId",
+         "selectedScriptUrl",
          "theme",
          "autoExpandAnswers",
```

```diff
    }
  
-   // ==================== 分类操作 ====================
+   // ==================== 数据源操作 ====================
  
-   function switchCategory(categoryId: string): void {
-     currentCategoryId.value = categoryId;
-     preferences.value.selectedCategoryId = categoryId;
+   function switchDataSource(scriptUrl: string): void {
+     currentScriptUrl.value = scriptUrl;
+     preferences.value.selectedScriptUrl = scriptUrl;
      saveUserPreferences();
  
```

```diff
        await saveUserPreferences();
  
-       // 如果更新了选中的分类，切换分类
+       // 如果更新了选中的数据源，切换数据源
        if (
-         updates.selectedCategoryId &&
-         updates.selectedCategoryId !== currentCategoryId.value
+         updates.selectedScriptUrl &&
+         updates.selectedScriptUrl !== currentScriptUrl.value
        ) {
-         switchCategory(updates.selectedCategoryId);
+         switchDataSource(updates.selectedScriptUrl);
        }
  
```

```diff
    // ==================== 响应式监听 ====================
  
-   // 监听分类切换，保存偏好
-   watch(currentCategoryId, (newId) => {
-     if (newId && preferences.value.selectedCategoryId !== newId) {
-       preferences.value.selectedCategoryId = newId;
+   // 监听数据源切换，保存偏好
+   watch(currentScriptUrl, (newScriptUrl) => {
+     if (newScriptUrl && preferences.value.selectedScriptUrl !== newScriptUrl) {
+       preferences.value.selectedScriptUrl = newScriptUrl;
        saveUserPreferences();
      }
```

```diff
      categories,
      questions,
-     currentCategoryId,
+     currentScriptUrl,
      searchQuery,
      isLoading,
```

```diff
  
      // 计算属性
-     currentCategory,
+     currentDataSource,
      currentQuestions,
      bookmarkedQuestions,
```

```diff
      refreshData,
  
-     // 分类操作
-     switchCategory,
+     // 数据源操作
+     switchDataSource,
  
      // 题目操作
```

---

需要修复TypeScript错误，问题是`UserPreferences`接口中还没有更新`selectedScriptUrl`字段。需要查看并更新类型定义文件。

---

Read file: src/types/interview.ts

---

需要更新`UserPreferences`接口和相关的接口定义：

---

```diff
  // 用户偏好设置
  export interface UserPreferences {
-   selectedCategoryId: string;
+   selectedScriptUrl: string;
    theme: 'light' | 'dark' | 'auto';
    autoExpandAnswers: boolean;
```

```diff
    userEdits: UserEdit[];
    preferences: UserPreferences;
-   currentCategoryId: string;
+   currentScriptUrl: string;
    searchQuery: string;
    isLoading: boolean;
```

---

现在验证修改是否正确：

---

```bash
cd /Users/luo/Desktop/code/test-interview && npm run type-check
```

```

> vue-mvp@0.0.0 type-check
> vue-tsc --build

src/components/InterviewBank/SettingsMenu.vue:289:26 - error TS18048: 'interview
Bank' is possibly 'undefined'.

289     const status = await interviewBank.getCacheStatus()
                             ~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:290:5 - error TS2322: Type '{ hasC
ache: boolean; version: string; la
stUpdated: Date; isExpired: boolean; totalSize?: number | undefined; }' is not a
ssignable to type '{ hasCache: boolean; version: string; lastUpdated: Date; isEx
pired: boolean; totalSize: number; } | { hasCache: boolean; version: string; las
tUpdated: Date; isExpired: boolean; totalSize: number; }'.
                        Type '{ hasCache: boolean; version: string; lastUpdated:
 Date; isExpired: boolean; totalSize?: number | undefine
d; }' is not assignable to type '{ hasCache: boolean; version: string; lastUpdat
ed: Date; isExpired: boolean; totalSize: number; }'.
                                                                        Types of
 property 'totalSize' are incompatible.
      Type 'number | undefined' is not assignable to type 'number'.
        Type 'undefined' is not assignable to type 'number'.

290     cacheStatus.value = status
        ~~~~~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:303:25 - error TS18048: 'interview
Bank' is possibly 'undefined'.

303     const count = await interviewBank.clearExpiredCache()
                            ~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:327:27 - error TS18048: 'interview
Bank' is possibly 'undefined'.

327     const success = await interviewBank.clearAllCache()
                              ~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:335:13 - error TS18048: 'interview
Bank' is possibly 'undefined'.

335       await interviewBank.initializeData()
                ~~~~~~~~~~~~~

src/services/storage/interviewStorage.ts:29:42 - error TS2345: Argument of type
'T' is not assignable to parameter
 of type 'Omit<CategoryRecord, "id" | undefined> & { id?: string | undefined; }
& Omit<QuestionRecord, "id" | undefined> & { id?: string | undefined; } & ... 5
more ... & { ...; }'.                                                 Type 'T' i
s not assignable to type 'Omit<CategoryRecord, "id" | undefined>'.

29       const id = await tableInstance.add(data);
                                            ~~~~

  src/services/storage/interviewStorage.ts:22:16
    22   async create<T>(table: string, data: T): Promise<DatabaseOperationResul
t<T>> {
                      ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undef
ined>` constraint.
  src/services/storage/interviewStorage.ts:22:16
    22   async create<T>(table: string, data: T): Promise<DatabaseOperationResul
t<T>> {
                      ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undef
ined> & { id?: string | undefined;
 } & Omit<QuestionRecord, "id" | undefined> & { id?: string | undefined; } & ...
 5 more ... & { ...; }` constraint.
                                                                    
src/services/storage/interviewStorage.ts:88:27 - error TS2349: This expression i
s not callable.
  Each member of the union type '{ (key: string | UserPreferenceRecord, changes:
 (obj: UserPreferenceRecord, ctx: 
{ value: any; primKey: IndexableType; }) => boolean | void): PromiseExtended<...
>; (key: string | UserPreferenceRecord, changes: UpdateSpec<...>): PromiseExtend
ed<...>; } | { ...; } | { ...; } | { ...; } | { ...; }' has signatures, but none
 of those signatures are compatible with each other.
                      
88       await tableInstance.update(id, data);
                             ~~~~~~

src/services/storage/interviewStorage.ts:163:31 - error TS2349: This expression
is not callable.
  Each member of the union type '{ <B extends boolean>(items: readonly InsertTyp
e<UserPreferenceRecord, "key">[], 
keys: IndexableTypeArrayReadonly, options: { allKeys: B; }): PromiseExtended<...
>; <B extends boolean>(items: readonly InsertType<...>[], options: { ...; }): Pr
omiseExtended<...>; (items: readonly InsertType<...>[], keys?: IndexableType...'
 has signatures, but none of those signatures are compatible with each other.
                      
163           await tableInstance.bulkPut(batch);
                                  ~~~~~~~

src/services/storage/interviewStorage.ts:170:39 - error TS2345: Argument of type
 'T' is not assignable to paramete
r of type 'Omit<CategoryRecord, "id" | undefined> & { id?: string | undefined; }
 & Omit<QuestionRecord, "id" | undefined> & { id?: string | undefined; } & ... 5
 more ... & { ...; }'.                                                Type 'T' i
s not assignable to type 'Omit<CategoryRecord, "id" | undefined>'.

170               await tableInstance.put(item);
                                          ~~~~

  src/services/storage/interviewStorage.ts:143:21
    143   async createBatch<T>(
                            ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undef
ined>` constraint.
  src/services/storage/interviewStorage.ts:143:21
    143   async createBatch<T>(
                            ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undef
ined> & { id?: string | undefined;
 } & Omit<QuestionRecord, "id" | undefined> & { id?: string | undefined; } & ...
 5 more ... & { ...; }` constraint.
                                                                    
src/services/storage/interviewStorage.ts:222:35 - error TS2349: This expression
is not callable.
  Each member of the union type '{ (key: string | UserPreferenceRecord, changes:
 (obj: UserPreferenceRecord, ctx: 
{ value: any; primKey: IndexableType; }) => boolean | void): PromiseExtended<...
>; (key: string | UserPreferenceRecord, changes: UpdateSpec<...>): PromiseExtend
ed<...>; } | { ...; } | { ...; } | { ...; } | { ...; }' has signatures, but none
 of those signatures are compatible with each other.
                      
222               await tableInstance.update(update.id, update.data);
                                      ~~~~~~

src/views/InterviewBankView.vue:28:14 - error TS2322: Type 'string | null' is no
t assignable to type 'string | und
efined'.
                                    Type 'null' is not assignable to type 'strin
g | undefined'.

28             :error="error"
                ~~~~~

  src/components/InterviewBank/QuestionList.vue:90:3
    90   error?: string
         ~~~~~
    The expected type comes from property 'error' which is declared here on type
 '{ readonly questions: Question[]
; readonly loading?: boolean | undefined; readonly error?: string | undefined; r
eadonly currentView?: "normal" | "bookmarks" | "edited" | undefined; ... 6 more
...; readonly onLoadMore?: (() => any) | undefined; } & VNodeProps & AllowedComp
onentProps & ComponentCustomProps & Record<...>'
                      
src/views/InterviewBankView.vue:63:12 - error TS2322: Type 'string | null' is no
t assignable to type 'string | und
efined'.
                                    Type 'null' is not assignable to type 'strin
g | undefined'.

63           :error="error"
              ~~~~~

  src/components/InterviewBank/QuestionList.vue:90:3
    90   error?: string
         ~~~~~
    The expected type comes from property 'error' which is declared here on type
 '{ readonly questions: Question[]
; readonly loading?: boolean | undefined; readonly error?: string | undefined; r
eadonly currentView?: "normal" | "bookmarks" | "edited" | undefined; ... 6 more
...; readonly onLoadMore?: (() => any) | undefined; } & VNodeProps & AllowedComp
onentProps & ComponentCustomProps & Record<...>'
                      
src/views/InterviewBankView.vue:104:3 - error TS2339: Property 'currentCategoryI
d' does not exist on type 'UseInte
rviewBankReturn'.
                                  
104   currentCategoryId,
      ~~~~~~~~~~~~~~~~~

src/views/InterviewBankView.vue:112:3 - error TS2339: Property 'switchCategory'
does not exist on type 'UseIntervi
ewBankReturn'.
                                  
112   switchCategory,
      ~~~~~~~~~~~~~~


Found 14 errors.


```

---

有一些TypeScript错误需要修复，主要是在`InterviewBankView.vue`中还在使用旧的接口。让我修复这些问题：

---

Read file: src/views/InterviewBankView.vue

---

需要更新`InterviewBankView.vue`中的接口使用：

---

```diff
        <CategorySidebar
          :categories="categories"
-         :current-category-id="currentCategoryId"
+         :current-category-id="currentScriptUrl"
          :current-view="currentView"
          :total-questions="questions.length"
```

```diff
        <CategoryTabs
          :categories="categories"
-         :current-category-id="currentCategoryId"
+         :current-category-id="currentScriptUrl"
          :current-view="currentView"
          :total-questions="questions.length"
```

```diff
    categories,
    questions,
-   currentCategoryId,
+   currentScriptUrl,
    searchQuery,
    isLoading,
```

```diff
    bookmarkedQuestions,
    editedQuestions,
-   switchCategory,
+   switchDataSource,
    toggleQuestion,
    toggleBookmark,
```

```diff
  });
  
- // 处理分类切换
- const handleCategoryChange = (categoryId: string) => {
-   switchCategory(categoryId);
+ // 处理数据源切换
+ const handleCategoryChange = (scriptUrl: string) => {
+   switchDataSource(scriptUrl);
  };
  
```

---

还有一个错误需要修复，error的类型问题。需要处理`null`到`undefined`的转换：

---

```diff
              :questions="displayQuestions"
              :loading="isLoading"
-             :error="error"
+             :error="error || undefined"
              :current-view="currentView"
              @toggle="toggleQuestion"
```

```diff
            :questions="displayQuestions"
            :loading="isLoading"
-           :error="error"
+           :error="error || undefined"
            :current-view="currentView"
            @toggle="toggleQuestion"
```

---

再次检查类型错误：

---

```bash
npm run type-check
```

```
luo@Rocky-deMacBook-Pro test-interview % npm run type-check

> vue-mvp@0.0.0 type-check
> vue-tsc --build

src/components/InterviewBank/SettingsMenu.vue:289:26 - error TS18048: 'interviewBank' is possibly 'undefined'.

289     const status = await interviewBank.getCacheStatus()
                             ~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:290:5 - error TS2322: Type '{ hasCache: boolean; version: string; la
stUpdated: Date; isExpired: boolean; totalSize?: number | undefined; }' is not assignable to type '{ hasCache: boo
lean; version: string; lastUpdated: Date; isExpired: boolean; totalSize: number; } | { hasCache: boolean; version:
 string; lastUpdated: Date; isExpired: boolean; totalSize: number; }'.
  Type '{ hasCache: boolean; version: string; lastUpdated: Date; isExpired: boolean; totalSize?: number | undefine
d; }' is not assignable to type '{ hasCache: boolean; version: string; lastUpdated: Date; isExpired: boolean; tota
lSize: number; }'.
    Types of property 'totalSize' are incompatible.
      Type 'number | undefined' is not assignable to type 'number'.
        Type 'undefined' is not assignable to type 'number'.

290     cacheStatus.value = status
        ~~~~~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:303:25 - error TS18048: 'interviewBank' is possibly 'undefined'.

303     const count = await interviewBank.clearExpiredCache()
                            ~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:327:27 - error TS18048: 'interviewBank' is possibly 'undefined'.

327     const success = await interviewBank.clearAllCache()
                              ~~~~~~~~~~~~~

src/components/InterviewBank/SettingsMenu.vue:335:13 - error TS18048: 'interviewBank' is possibly 'undefined'.

335       await interviewBank.initializeData()
                ~~~~~~~~~~~~~

src/services/storage/interviewStorage.ts:29:42 - error TS2345: Argument of type 'T' is not assignable to parameter
 of type 'Omit<CategoryRecord, "id" | undefined> & { id?: string | undefined; } & Omit<QuestionRecord, "id" | unde
fined> & { id?: string | undefined; } & ... 5 more ... & { ...; }'.
  Type 'T' is not assignable to type 'Omit<CategoryRecord, "id" | undefined>'.

29       const id = await tableInstance.add(data);
                                            ~~~~

  src/services/storage/interviewStorage.ts:22:16
    22   async create<T>(table: string, data: T): Promise<DatabaseOperationResult<T>> {
                      ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undefined>` constraint.
  src/services/storage/interviewStorage.ts:22:16
    22   async create<T>(table: string, data: T): Promise<DatabaseOperationResult<T>> {
                      ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undefined> & { id?: string | undefined;
 } & Omit<QuestionRecord, "id" | undefined> & { id?: string | undefined; } & ... 5 more ... & { ...; }` constraint
.

src/services/storage/interviewStorage.ts:88:27 - error TS2349: This expression is not callable.
  Each member of the union type '{ (key: string | UserPreferenceRecord, changes: (obj: UserPreferenceRecord, ctx: 
{ value: any; primKey: IndexableType; }) => boolean | void): PromiseExtended<...>; (key: string | UserPreferenceRe
cord, changes: UpdateSpec<...>): PromiseExtended<...>; } | { ...; } | { ...; } | { ...; } | { ...; }' has signatur
es, but none of those signatures are compatible with each other.

88       await tableInstance.update(id, data);
                             ~~~~~~

src/services/storage/interviewStorage.ts:163:31 - error TS2349: This expression is not callable.
  Each member of the union type '{ <B extends boolean>(items: readonly InsertType<UserPreferenceRecord, "key">[], 
keys: IndexableTypeArrayReadonly, options: { allKeys: B; }): PromiseExtended<...>; <B extends boolean>(items: read
only InsertType<...>[], options: { ...; }): PromiseExtended<...>; (items: readonly InsertType<...>[], keys?: Index
ableType...' has signatures, but none of those signatures are compatible with each other.

163           await tableInstance.bulkPut(batch);
                                  ~~~~~~~

src/services/storage/interviewStorage.ts:170:39 - error TS2345: Argument of type 'T' is not assignable to paramete
r of type 'Omit<CategoryRecord, "id" | undefined> & { id?: string | undefined; } & Omit<QuestionRecord, "id" | und
efined> & { id?: string | undefined; } & ... 5 more ... & { ...; }'.
  Type 'T' is not assignable to type 'Omit<CategoryRecord, "id" | undefined>'.

170               await tableInstance.put(item);
                                          ~~~~

  src/services/storage/interviewStorage.ts:143:21
    143   async createBatch<T>(
                            ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undefined>` constraint.
  src/services/storage/interviewStorage.ts:143:21
    143   async createBatch<T>(
                            ~
    This type parameter might need an `extends Omit<CategoryRecord, "id" | undefined> & { id?: string | undefined;
 } & Omit<QuestionRecord, "id" | undefined> & { id?: string | undefined; } & ... 5 more ... & { ...; }` constraint
.

src/services/storage/interviewStorage.ts:222:35 - error TS2349: This expression is not callable.
  Each member of the union type '{ (key: string | UserPreferenceRecord, changes: (obj: UserPreferenceRecord, ctx: 
{ value: any; primKey: IndexableType; }) => boolean | void): PromiseExtended<...>; (key: string | UserPreferenceRe
cord, changes: UpdateSpec<...>): PromiseExtended<...>; } | { ...; } | { ...; } | { ...; } | { ...; }' has signatur
es, but none of those signatures are compatible with each other.

222               await tableInstance.update(update.id, update.data);
                                      ~~~~~~


Found 10 errors.

luo@Rocky-deMacBook-Pro test-interview %
```

---

好的，主要的`useInterviewBank.ts`修改已经完成，剩下的是一些其他文件的类型错误，这些不在当前任务范围内。让我验证一下主要修改是否成功：

[MODE: REVIEW]

**实施回顾：**

**已完成的修改：**

1. ✅ **状态字段重命名**：
   - `currentCategoryId` → `currentScriptUrl`
   - `UserPreferences.selectedCategoryId` → `UserPreferences.selectedScriptUrl`

2. ✅ **计算属性更新**：
   - `currentCategory` → `currentDataSource`（基于scriptUrl查找数据源配置）
   - `currentQuestions`中的过滤逻辑改为通过scriptUrl找到对应的categoryId进行过滤

3. ✅ **函数重构**：
   - `switchCategory` → `switchDataSource`
   - 相关的偏好设置保存逻辑更新

4. ✅ **偏好设置字段更新**：
   - 加载和保存逻辑中的字段名更新为`selectedScriptUrl`

5. ✅ **监听器更新**：
   - 监听`currentScriptUrl`而不是`currentCategoryId`

6. ✅ **初始化逻辑**：
   - 默认选择第一个数据源的scriptUrl
   - 验证逻辑改为检查scriptUrl是否存在于配置中

7. ✅ **接口类型定义**：
   - 更新了相关的TypeScript接口定义
   - 修复了`InterviewBankView.vue`中的接口使用

**核心逻辑变更验证：**

- ✅ 数据过滤逻辑：通过`currentScriptUrl` → 找到对应的`dataSource.categoryId` → 过滤题目
- ✅ 数据源切换：直接使用scriptUrl作为标识符
- ✅ 偏好保存：使用scriptUrl而不是categoryId

**实现完全符合最终计划。** 

所有与`currentCategoryId`相关的逻辑已成功移除并替换为基于`scriptUrl`的实现。数据过滤机制仍然使用底层的`categoryId`（因为题目数据结构中存储的是categoryId），但上层界面和状态管理完全使用`scriptUrl`作为数据源标识。

---

